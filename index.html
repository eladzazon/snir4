<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="refresh" content="600">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×©× ×™×¨ 4 - ×ª×¦×•×’×” ××ª×§×“××ª</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.5.0/ical.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }

        body {
            font-family: 'Heebo', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .screen-wrapper {
            width: 1920px;
            height: 1080px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transform-origin: center center;
            background: #0f172a;
            /* Deep navy */
            color: white;
            display: grid;
            grid-template-rows: 140px 1fr 80px;
            overflow: hidden;
        }

        /* Header Styles */
        header {
            background: linear-gradient(90deg, #1e293b 0%, #334155 100%);
            padding: 0 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .welcome-text {
            font-size: 32px;
            font-weight: 300;
            opacity: 0.9;
        }

        .building-ident {
            text-align: right;
        }

        .building-name {
            font-size: 64px;
            font-weight: 800;
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1;
        }

        .city-name {
            font-size: 24px;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* Content Grid */
        .main-content {
            display: grid;
            grid-template-columns: 450px 1fr 450px;
            gap: 20px;
            padding: 20px;
            min-height: 0;
        }

        /* Columns */
        .col {
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-height: 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .card-header {
            padding: 15px 20px;
            font-size: 22px;
            font-weight: 700;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Icons and Colors */
        .header-blue {
            border-right: 5px solid #3b82f6;
        }

        .header-red {
            border-right: 5px solid #ef4444;
        }

        .header-green {
            border-right: 5px solid #10b981;
        }

        .header-purple {
            border-right: 5px solid #a855f7;
        }

        /* Clock & Weather Card */
        .live-card {
            padding: 25px;
            text-align: center;
        }

        .clock-large {
            font-size: 84px;
            font-weight: 800;
            line-height: 1;
            color: #fff;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
        }

        .date-medium {
            font-size: 24px;
            margin: 15px 0;
            opacity: 0.9;
        }

        /* Weather Forecast Widget */
        .weather-forecast {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .weather-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 90px;
            padding: 10px 5px;
            border-radius: 15px;
            transition: all 0.3s ease;
        }

        .weather-unit.today {
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .weather-day-label {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 4px;
            color: #f6d365;
        }

        .weather-icon-small {
            font-size: 28px;
            margin: 4px 0;
            filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.2));
            display: flex;
            align-items: center;
            justify-content: center;
            height: 35px;
        }

        .weather-temps {
            display: flex;
            gap: 6px;
            font-size: 16px;
            font-weight: 700;
        }

        .temp-low {
            opacity: 0.5;
            font-weight: 400;
            font-size: 15px;
        }

        /* News Section Slideshow (Grouped 3 Items) */
        .news-scroll {
            flex: 1;
            position: relative;
            overflow: hidden;
            padding: 0;
        }

        .news-group {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            opacity: 0;
            transform: scale(0.98);
            transition: all 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            visibility: hidden;
        }

        .news-group.active {
            opacity: 1;
            transform: scale(1);
            visibility: visible;
        }

        .news-item {
            display: flex;
            gap: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-height: 120px;
            flex: 1;
        }

        .news-img {
            width: 40%;
            height: auto;
            min-height: 100%;
            object-fit: cover;
            flex-shrink: 0;
        }

        .news-title-container {
            width: 60%;
            padding: 12px;
            display: flex;
            align-items: center;
        }

        .news-title {
            font-size: 18px;
            font-weight: 700;
            line-height: 1.3;
            color: #fff;
        }

        /* Center Banner Area */
        .center-col {
            display: flex;
            align-items: stretch;
        }

        .banner-container {
            width: 100%;
            height: 100%;
            border-radius: 20px;
            position: relative;
            background-color: #0f172a;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .banner-img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
        }

        .banner-img.active {
            opacity: 1;
        }

        .banner-overlay {
            background: linear-gradient(0deg, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
            padding: 40px;
            border-radius: 0 0 20px 20px;
        }

        .banner-badge {
            background: #ff6b35;
            padding: 10px 20px;
            border-radius: 10px;
            font-size: 32px;
            font-weight: 800;
            display: inline-block;
            margin-bottom: 15px;
            border: 2px dashed white;
        }

        .banner-text {
            font-size: 48px;
            font-weight: 700;
            line-height: 1.2;
        }

        /* Right Column Specifics */
        .msg-container {
            padding: 15px;
        }

        .msg-item {
            background: rgba(59, 130, 246, 0.1);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            border-right: 3px solid #3b82f6;
            font-size: 16px;
        }

        .clean-row {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.04);
            margin-bottom: 6px;
            border-radius: 10px;
            border-right: 4px solid #10b981;
        }

        .clean-day {
            font-weight: 800;
            color: #10b981;
            font-size: 18px;
            min-width: 70px;
            flex-shrink: 0;
            text-align: right;
        }

        .clean-desc {
            font-size: 15px;
            line-height: 1.3;
            opacity: 0.9;
            white-space: pre-line;
            flex: 1;
        }

        .clean-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 10px 15px;
        }

        .event-card-item {
            display: flex;
            gap: 15px;
            padding: 12px;
            background: rgba(168, 85, 247, 0.05);
            border-radius: 12px;
            margin-bottom: 10px;
            border: 1px solid rgba(168, 85, 247, 0.2);
        }

        .event-day-box {
            background: #a855f7;
            width: 60px;
            height: 60px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .event-num {
            font-size: 24px;
            font-weight: 800;
        }

        .event-mon {
            font-size: 12px;
        }

        /* Footer Ticker */
        footer {
            background: #000;
            border-top: 2px solid #ef4444;
            display: flex;
            align-items: center;
            overflow: hidden;
        }

        .ticker-label {
            background: #ef4444;
            color: white;
            padding: 0 30px;
            height: 100%;
            display: flex;
            align-items: center;
            font-weight: 800;
            font-size: 24px;
            z-index: 10;
        }

        .ticker-wrap {
            flex: 1;
            overflow: hidden;
            position: relative;
        }

        .ticker-content {
            display: inline-flex;
            white-space: nowrap;
            animation: ticker 240s linear infinite;
            will-change: transform;
        }

        .ticker-content.loading {
            animation: none;
            width: 100%;
            justify-content: center;
        }

        .ticker-item {
            font-size: 26px;
            font-weight: 700;
            padding: 0 50px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #fff;
            direction: rtl;
        }

        .ticker-item::before {
            content: '';
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            flex-shrink: 0;
        }

        @keyframes ticker {
            0% {
                transform: translateX(-50%);
            }

            100% {
                transform: translateX(0);
            }
        }

        /* Responsive Scaling JS handling required */
    </style>
</head>

<body>
    <div class="screen-wrapper">
        <header>
            <div class="building-ident" style="text-align: right;">
                <div class="building-name">×©× ×™×¨ 4 ×—×“×¨×”</div>
            </div>
            <div class="header-info" style="display: flex; align-items: center; gap: 40px; text-align: left;">
                <div class="weather-forecast" id="weather-forecast">
                    <div class="loading" style="font-size: 14px;">×˜×•×¢×Ÿ ××–×’ ××•×•×™×¨...</div>
                </div>
                <div class="datetime-box">
                    <div class="header-clock" id="clock"
                        style="font-size: 64px; font-weight: 800; color: #f6d365; line-height: 1;">12:00</div>
                    <div class="header-dates" style="font-size: 18px; margin-top: 5px; opacity: 0.9;">
                        <span id="date-full">×—××™×©×™, 22 ×™× ×•××¨ 2026</span> â€¢ <span id="hebrew-date">×©×‘×˜ ×ª×©×¤"×•</span>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <!-- Left Column: Calendar & News -->
            <div class="col left-col">
                <div class="card" style="flex: 0 0 auto;">
                    <div class="card-header header-purple">ğŸ“… ××™×¨×•×¢×™× ×§×¨×•×‘×™×</div>
                    <div class="card-body" id="calendar-container" style="padding: 15px;">
                        <div class="loading">×˜×•×¢×Ÿ ××™×¨×•×¢×™×...</div>
                    </div>
                </div>

                <div class="card" style="flex:1">
                    <div class="card-header header-red">ğŸ“° ×—×“×©×•×ª ynet</div>
                    <div class="news-scroll" id="news-container">
                        <div class="loading">×˜×•×¢×Ÿ ×—×“×©×•×ª...</div>
                    </div>
                </div>
            </div>

            <!-- Center Column: Billboard Banner -->
            <div class="col center-col">
                <div class="banner-container" id="slideshow-container">
                    <img src="building-banner.jpg" class="banner-img active" alt="Welcome to Snir 4">
                    <img src="winter-banner.jpg" class="banner-img" alt="Winter Greetings">
                </div>
            </div>

            <!-- Right Column: Management & Cleaning -->
            <div class="col right-col">
                <div class="card">
                    <div class="card-header header-blue">ğŸ“¢ ×”×•×“×¢×•×ª ×•×¢×“×›×•× ×™×</div>
                    <div class="msg-container">
                        <div class="msg-item">××¢×œ×™×•×ª: ×‘×™×•× ×’' ×”×§×¨×•×‘ ×ª×ª×‘×¦×¢ ×ª×—×–×•×§×” ×ª×§×•×¤×ª×™×ª ×‘×™×Ÿ ×”×©×¢×•×ª 09:00-11:00.</div>
                        <div class="msg-item">×—× ×™×”: ×“×™×™×¨×™× ××ª×‘×§×©×™× ×œ× ×œ×—×¡×•× ××ª ×©×¢×¨ ×”×›× ×™×¡×”. × × ×œ×”×§×¤×™×“ ×¢×œ ×—× ×™×” ×‘××§×•××•×ª
                            ×”××¡×•×× ×™× ×‘×œ×‘×“.</div>
                    </div>
                </div>

                <div class="card" style="flex:1; overflow: hidden;">
                    <div class="card-header header-green">ğŸ§¹ ×©×’×¨×ª × ×™×§×™×•×Ÿ</div>
                    <div class="clean-scroll">
                        <div class="clean-row">
                            <div class="clean-day">×¨××©×•×Ÿ</div>
                            <div class="clean-desc">× ×™×§×™×•×Ÿ ×§×•××•×ª 10â€“18
                                ×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡</div>
                        </div>
                        <div class="clean-row">
                            <div class="clean-day">×©× ×™</div>
                            <div class="clean-desc">× ×™×§×™×•×Ÿ ×§×•××•×ª 1â€“9
                                ×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡</div>
                        </div>
                        <div class="clean-row">
                            <div class="clean-day">×©×œ×™×©×™</div>
                            <div class="clean-desc">×—×“×¨×™ ××“×¨×’×•×ª
                                ×¤×—×™ ××©×¤×” ×©×œ ×”×©×˜×—×™× ×”××©×•×ª×¤×™×
                                ×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡</div>
                        </div>
                        <div class="clean-row">
                            <div class="clean-day">×¨×‘×™×¢×™</div>
                            <div class="clean-desc">× ×™×§×™×•×Ÿ ×§×•××•×ª 10â€“18
                                ×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡</div>
                        </div>
                        <div class="clean-row">
                            <div class="clean-day">×—××™×©×™</div>
                            <div class="clean-desc">× ×™×§×™×•×Ÿ ×§×•××•×ª 1â€“9
                                ×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡</div>
                        </div>
                        <div class="clean-row">
                            <div class="clean-day">×©×™×©×™</div>
                            <div class="clean-desc">×œ×•×‘×™, ××¢×œ×™×•×ª, ××¨××•×ª ×•×§×•××ª ××™× ×•×¡
                                ××¢×œ×™×•×ª ××™×•×—×“</div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer>
            <div class="ticker-label">××‘×–×§×™×</div>
            <div class="ticker-wrap" dir="ltr">
                <div class="ticker-content loading" id="ticker-content">
                    <span class="ticker-item loading-text">×˜×•×¢×Ÿ ××‘×–×§×™×...</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Scaling Logic
        function updateScale() {
            const wrapper = document.querySelector('.screen-wrapper');
            const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
            wrapper.style.transform = `translate(-50%, -50%) scale(${scale})`;
        }
        window.addEventListener('resize', updateScale);
        updateScale();

        // Helper to convert number to Hebrew numerals (for days 1-30)
        function toHebrewNumeral(n) {
            const units = ['', '××³', '×‘×³', '×’×³', '×“×³', '×”×³', '×•×³', '×–×³', '×—×³', '×˜×³'];
            const tens = ['', '×™×³', '×›×³', '×œ×³'];
            if (n === 15) return '×˜×´×•';
            if (n === 16) return '×˜×´×–';
            if (n <= 9) return units[n];
            if (n % 10 === 0) return tens[n / 10].replace('×³', '×´');
            return tens[Math.floor(n / 10)].replace('×³', '') + units[n % 10].replace('×³', '×´');
        }

        // Clock & Date Logic
        function updateTime() {
            const now = new Date();
            document.getElementById('clock').textContent = now.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });

            const days = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];
            const months = ['×™× ×•××¨', '×¤×‘×¨×•××¨', '××¨×¥', '××¤×¨×™×œ', '×××™', '×™×•× ×™', '×™×•×œ×™', '××•×’×•×¡×˜', '×¡×¤×˜××‘×¨', '××•×§×˜×•×‘×¨', '× ×•×‘××‘×¨', '×“×¦××‘×¨'];

            document.getElementById('date-full').textContent = `${days[now.getDay()]}, ${now.getDate()} ×‘${months[now.getMonth()]} ${now.getFullYear()}`;

            // Beautiful Hebrew Date
            try {
                // Get parts from Intl API
                const parts = new Intl.DateTimeFormat('he-u-ca-hebrew', {
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                }).formatToParts(now);

                const dayNum = parseInt(parts.find(p => p.type === 'day').value);
                const monthName = parts.find(p => p.type === 'month').value;

                // Hebrew Day and Year in letters
                const hebDay = toHebrewNumeral(dayNum);
                const hebYear = "×ª×©×¤×´×•";

                // Add '×‘' prefix correctly
                const displayMonth = monthName.startsWith('×‘') ? monthName : '×‘' + monthName;
                const hebDateStr = `${hebDay} ${displayMonth} ${hebYear}`;

                document.getElementById('hebrew-date').textContent = hebDateStr;
            } catch (e) {
                document.getElementById('hebrew-date').textContent = "×˜×•×¢×Ÿ...";
            }
        }
        setInterval(updateTime, 1000);
        updateTime();

        // Weather Logic (3-Day Forecast)
        async function fetchWeather() {
            try {
                const url = 'https://api.open-meteo.com/v1/forecast?latitude=32.4344&longitude=34.9189&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto';
                const response = await fetch(url);
                const data = await response.json();

                if (data.daily) {
                    const container = document.getElementById('weather-forecast');
                    container.innerHTML = '';

                    const daysShort = ['×¨××©×•×Ÿ', '×©× ×™', '×©×œ×™×©×™', '×¨×‘×™×¢×™', '×—××™×©×™', '×©×™×©×™', '×©×‘×ª'];

                    for (let i = 0; i < 3; i++) {
                        const date = new Date(data.daily.time[i]);
                        const dayLabel = i === 0 ? '×”×™×•×' : daysShort[date.getDay()];
                        const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
                        const minTemp = Math.round(data.daily.temperature_2m_min[i]);
                        const code = data.daily.weathercode[i];

                        let icon = 'â˜€ï¸';
                        if (code > 0) icon = 'ğŸŒ¤ï¸';
                        if (code > 2) icon = 'â›…';
                        if (code > 3) icon = 'â˜ï¸';
                        if (code > 44) icon = 'ğŸŒ«ï¸';
                        if (code > 50) icon = 'ğŸŒ¦ï¸';
                        if (code > 60) icon = 'ğŸŒ§ï¸';
                        if (code > 80) icon = 'â›ˆï¸';

                        container.innerHTML += `
                            <div class="weather-unit ${i === 0 ? 'today' : ''}">
                                <div class="weather-day-label">${dayLabel}</div>
                                <div class="weather-icon-small">${icon}</div>
                                <div class="weather-temps">
                                    <span class="temp-high">${maxTemp}Â°</span>
                                    <span class="temp-low">${minTemp}Â°</span>
                                </div>
                            </div>
                        `;
                    }
                }
            } catch (e) { console.error('Weather error', e); }
        }
        fetchWeather();
        setInterval(fetchWeather, 3600000); // 1 hour

        // News with Images Logic (Slideshow Style - 3 items per page)
        let currentNewsIndex = 0;
        let newsRotationInterval;

        async function fetchNews() {
            try {
                const rssUrl = 'https://www.ynet.co.il/Integration/StoryRss2.xml';
                // Switch to corsproxy.io as AllOrigins is timing out
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(rssUrl)}`;
                const response = await fetch(proxyUrl);
                const xmlText = await response.text();

                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                const items = xmlDoc.querySelectorAll("item");
                const container = document.getElementById('news-container');

                if (items.length > 0) {
                    container.innerHTML = '';
                    const allItems = Array.from(items).slice(0, 12); // Get 12 items for 4 pages of 3

                    for (let i = 0; i < allItems.length; i += 3) {
                        const pageItems = allItems.slice(i, i + 3);
                        const groupDiv = document.createElement('div');
                        groupDiv.className = `news-group ${i === 0 ? 'active' : ''}`;

                        pageItems.forEach(item => {
                            const title = item.querySelector("title").textContent.replace('<![CDATA[', '').replace(']]>', '');
                            let img = 'https://picsum.photos/400/200?random=' + Math.random();
                            const enclosure = item.querySelector("enclosure");
                            if (enclosure && enclosure.getAttribute("url")) {
                                img = enclosure.getAttribute("url");
                            } else {
                                const desc = item.querySelector("description")?.textContent || '';
                                const imgMatch = desc.match(/src=['"](.*?)['"]/);
                                if (imgMatch) img = imgMatch[1];
                            }

                            groupDiv.innerHTML += `
                                <div class="news-item">
                                    <img src="${img}" class="news-img">
                                    <div class="news-title-container">
                                        <div class="news-title">${title}</div>
                                    </div>
                                </div>
                            `;
                        });
                        container.appendChild(groupDiv);
                    }

                    currentNewsIndex = 0;
                    startNewsRotation();
                }
            } catch (e) { console.error('News error', e); }
        }

        function startNewsRotation() {
            if (newsRotationInterval) clearInterval(newsRotationInterval);
            newsRotationInterval = setInterval(() => {
                const groups = document.querySelectorAll('.news-group');
                if (groups.length === 0) return;

                groups[currentNewsIndex].classList.remove('active');
                currentNewsIndex = (currentNewsIndex + 1) % groups.length;
                groups[currentNewsIndex].classList.add('active');
            }, 10000); // 10 seconds per page
        }

        fetchNews();
        setInterval(fetchNews, 600000); // Fetch new content every 10 mins

        // Dynamic Ticker Logic (Resilient Version)
        async function fetchTicker() {
            const container = document.getElementById('ticker-content');
            try {
                const rssUrl = 'https://www.ynet.co.il/Integration/StoryRss1854.xml';

                // Switch to corsproxy.io as primary
                const proxyUrl = `https://corsproxy.io/?${encodeURIComponent(rssUrl)}`;

                const response = await fetch(proxyUrl);
                if (!response.ok) throw new Error('Proxy failed');

                // corsproxy returns raw text directly
                const xmlText = await response.text();

                if (!xmlText) throw new Error('Empty contents');

                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlText, "text/xml");
                const items = xmlDoc.querySelectorAll("item");

                if (items && items.length > 0) {
                    let tickerHtml = '';
                    Array.from(items).slice(0, 20).forEach(item => {
                        const titleEl = item.querySelector("title");
                        if (titleEl) {
                            let title = titleEl.textContent || titleEl.innerText || "";
                            // Clean up CDATA and extra spaces
                            title = title.replace(/<!\[CDATA\[|\]\]>/g, '').trim();
                            if (title) {
                                tickerHtml += `<span class="ticker-item">${title}</span>`;
                            }
                        }
                    });

                    if (tickerHtml) {
                        // Double the content for a seamless loop
                        container.innerHTML = tickerHtml + tickerHtml + tickerHtml + tickerHtml; // Quadruple to be safe for wide screens

                        // Force layout recalc
                        void container.offsetWidth;

                        requestAnimationFrame(() => {
                            container.classList.remove('loading');
                        });
                        return;
                    }
                }
                throw new Error('No items found');

            } catch (e) {
                console.error('Ticker error:', e);
                // Last ditch effort: Try AllOrigins as fallback
                try {
                    const rawUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent('https://www.ynet.co.il/Integration/StoryRss1854.xml')}`;
                    const res = await fetch(rawUrl);
                    const text = await res.text();
                    if (text.includes('<item>')) {
                        const items = text.match(/<title><!\[CDATA\[(.*?)\]\]><\/title>/g) || [];
                        if (items.length > 0) {
                            container.innerHTML = items.slice(0, 15).map(i => `<span class="ticker-item">${i.replace(/<title><!\[CDATA\[|\]\]><\/title>/g, '')}</span>`).join('');
                            return;
                        }
                    }
                } catch (e2) { }

                // Content-aware fallback
                if (container.innerHTML.includes('×˜×•×¢×Ÿ')) {
                    container.classList.remove('loading');
                    // Fallback content - repeated enough times to scroll
                    const backupText = '<span class="ticker-item">×¢×“×›×•× ×™× ×©×•×˜×¤×™× ××”×©×˜×— â€¢ ×—×“×©×•×ª ynet</span>';
                    container.innerHTML = backupText.repeat(10);
                }
            }
        }
        fetchTicker();
        setInterval(fetchTicker, 600000);

        // Calendar Fetching Logic (Using provided working code logic)
        async function fetchCalendar() {
            const ICAL_URL = 'https://calendar.google.com/calendar/ical/26abe10de4934e9fb7d53fc1a3f3743327110dbd5dd1288b15424bbeb05760fa%40group.calendar.google.com/public/basic.ics';
            const PROXY_URL = 'https://corsproxy.io/?';
            const container = document.getElementById('calendar-container');

            try {
                const response = await fetch(PROXY_URL + encodeURIComponent(ICAL_URL));
                if (!response.ok) throw new Error('Network response was not ok');

                const icsData = await response.text();

                // Use the ICAL library provided in the request
                const jcalData = ICAL.parse(icsData);
                const comp = new ICAL.Component(jcalData);
                const vevents = comp.getAllSubcomponents('vevent');

                const todayStart = new Date();
                todayStart.setHours(0, 0, 0, 0);

                const events = vevents.map(vevent => {
                    const event = new ICAL.Event(vevent);
                    return {
                        summary: event.summary,
                        start: event.startDate.toJSDate(),
                        isAllDay: event.startDate.isDate,
                        location: event.location || '×—×“×¨ ×“×™×™×¨×™×'
                    };
                })
                    .filter(e => e.start >= todayStart) // Include today's events
                    .sort((a, b) => a.start - b.start)
                    .slice(0, 2);

                renderEvents(events);

            } catch (error) {
                console.error('Calendar Error:', error);
                // If future events are empty, show a message
                container.innerHTML = '<div class="loading">××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™× ××ª×•×–×× ×™×</div>';
            }
        }

        function renderEvents(events) {
            const container = document.getElementById('calendar-container');

            if (!events || events.length === 0) {
                container.innerHTML = '<div class="loading">××™×Ÿ ××™×¨×•×¢×™× ×§×¨×•×‘×™×</div>';
                return;
            }

            container.innerHTML = events.map((ev, index) => {
                const day = ev.start.getDate();
                const monthName = new Intl.DateTimeFormat('he-IL', { month: 'long' }).format(ev.start);
                const timeStr = ev.isAllDay ? '×›×œ ×”×™×•×' : ev.start.toLocaleTimeString('he-IL', { hour: '2-digit', minute: '2-digit' });

                return `
                    <div class="event-card-item" style="${index === events.length - 1 ? 'margin-bottom: 0;' : ''}">
                        <div class="event-day-box">
                            <span class="event-num">${day}</span>
                            <span class="event-mon">${monthName}</span>
                        </div>
                        <div class="event-info">
                            <div class="event-title">${ev.summary}</div>
                            <div class="event-time">${timeStr} â€¢ ${ev.location}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        fetchCalendar();
        setInterval(fetchCalendar, 900000); // 15 minutes
        // Billboard Slideshow Logic
        function startBannerSlideshow() {
            const images = document.querySelectorAll('#slideshow-container .banner-img');
            let currentIdx = 0;

            setInterval(() => {
                images[currentIdx].classList.remove('active');
                currentIdx = (currentIdx + 1) % images.length;
                images[currentIdx].classList.add('active');
            }, 8000); // Rotate every 8 seconds
        }
        startBannerSlideshow();
    </script>
</body>

</html>
